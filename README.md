# TPPC Discord Utility Bot

A small Node.js Discord bot for TPPC community servers.
Commands are explicit (prefixed with `!`) to avoid spam and false positives.

## Features

- Fun commands: !awesome, !roll, !choose, !coinflip, !rig
- FAQ command: !faq <question> with fuzzy matching (canned answers only)
- Live-reload FAQ data: !faqreload (admin only)
- Wiki lookup: !wiki <term> using a local titles index (Cloudflare-proof)
- NG list: !ng pulled from data/ngs.json
- Autogenerated !help (admin commands hidden from non-admins)

## Project layout

- bot.js — Discord client + message event loop
- commands.js — command registry + handlers
- faq.js — FAQ engine (fuzzy matching, near-miss logging, reload)
- wiki.js — local wiki title search + link builder
- data/wiki_data.json — list of wiki page titles (local index)
- data/ngs.json — list of current New Goldens (NGs)
- faq.json — FAQ entries (triggers + responses)
- logs/near_miss.log — optional near-miss logging output

## Requirements

- Node.js 20+ recommended (Node 21+ also fine)
- A Discord bot token (Discord Developer Portal)

## Setup

    npm install
    cp .env.example .env
    # edit .env with your real token and settings
    npm start

## Environment variables

Create a .env (not committed). Example keys:

- DISCORD_TOKEN — required
- ALLOWED_CHANNEL_IDS — comma-separated channel IDs (empty = all channels)
- DEFAULT_THRESHOLD — default FAQ match threshold (0–1)
- NEAR_MISS_MIN / NEAR_MISS_MAX — near-miss logging band
- NEAR_MISS_LOG_FILE — log file path

## Commands

### General

- !help — list commands available to you
- !awesome [@user] — random 0–101% awesome
- !coinflip [@user] — Heads/Tails
- !rig [@user] — “blessed by rnjesus”
- !roll NdM [@user] — rolls N numbers in range 0..M (example: !roll 3d100)
- !choose option1 option2 ... — choose one option from a list

### TPPC utilities

- !ng — show current NG list from data/ngs.json
- !wiki <term> — find matching TPPC wiki pages via local title index
- !faq <question> — respond with a canned FAQ answer if confidently matched

### Admin

- !faqreload — reload faq.json without restarting (Admin / Manage Server only)

## Updating NGs

Edit data/ngs.json and restart the bot (or add a reload command later if desired).

data/ngs.json can be either:

    ["Glaceon", "Eevee"]

or:

    { "ngs": ["Glaceon", "Eevee"] }

## Updating FAQs

Edit faq.json and run:

- !faqreload (admin) to reload without a restart

FAQ answers are canned only (no AI-generated responses).

## Deployment (VPS)

Typical VPS flow:

    git clone <repo>
    cd <repo>
    npm ci
    cp .env.example .env
    nano .env
    npm start

For long-running deployment, use a process manager (PM2 recommended):

    pm2 start bot.js --name tppc-bot
    pm2 save
    pm2 startup

## Contributing / Adding commands

All command logic lives in commands.js.

Add a command by registering it:

    register("!mycmd", async ({ message, rest }) => {
      await message.reply("You said: " + rest.trim());
    }, "!mycmd — does a thing");

The !help output updates automatically based on these help strings.
